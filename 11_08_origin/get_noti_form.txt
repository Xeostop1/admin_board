<!--#include virtual=/inc/dev/vbutil.inc-->
<!--#include virtual=/inc/dev/top.inc-->
<!--#include virtual=/classes/notification.asp--> 

<%	
admin_id="mars1030"	
dir_code="501"
noti_id = Request("noti_id")
admin_id = Request("admin_id")

pvType=Request("pvType")
pvLang=Request("pvLang")
%>
<style>
	.table_datagrid th{width:100px;height:inherit}
	.table_datagrid td{text-align:left;}
	textarea{height:100px;}
	.sortable { list-style-type: none; margin: 0; padding: 0; width: 100%; }
	.sortable li { margin: 3px 3px 3px 0; padding: 1px; float: left;  font-size: 4em; text-align: center; cursor:move}

    /* ëª¨ë‹¬ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
      }
      
      .modal-content {
        background-color:#fefefe;
        margin: 10% auto;
        padding:20px;
        border :3px solid #888;
        border-radius :10px ;
        width :50% ;
        max-height: 70vh; 
        overflow-y: auto    
      }
      .close{
       cursor:pointer ;
       float:right ;
       font-size :28px ; 
       font-weight:bold ; 
      }
      /*ë°œì†¡ìˆ˜ë‹¨*/
        .flex_div{
            border-bottom: 2px solid #ccc;
            width: 390px;
            padding-bottom: 5px;
        }
        .flex_div ul, .flex_div_info ul {
            list-style-type: none;
            padding: 0;
        }
        .flex_div li, .flex_div_info li {
            display: inline-block;
            margin-right: 20px;    
        }
        .sendInfo{
            margin-bottom: 3px;
            border-bottom: 1px solid #ccc;
            width: 450px;
        }
        .flex_div_info li{
            width: 50px;
            padding-bottom: 3px;
        }
        .flex_div_info li:nth-child(2) {
            width: 50px;
            
            padding-left: 10px;
          }
          .flex_div_info li:nth-child(3){
            margin-left: -2px;
          }
          .flex_div_info li:nth-child(5){
            width: 151px;
          }
        .sendNow_btn, .flag_checkbox {
            cursor: pointer;
        }
          

        
</style>
<script src="/jquery/noti.js"></script>
<script>


//=====í† í”½_ê²€ìƒ‰=====
	function fnSearchTopic(){    
        $('select[name="topic_value"]').empty();   
		noti_id="<%=noti_id%>"
        var topic_key=$('select[name="topic_key"]').val();
		var topic_value=$('select[name="topic_value"]').val();
		var topic_search=$('input[name="topic_search"]').val();
        var result=mFnSearchTopic(noti_id,topic_key,topic_search);
        var target=$('select[name="topic_value"]'); 
        var options = $.map(result, item => `<option value="${item.value}">${item.text}</option>`).join('');
        target.append(options);
	}

//=====í† í”½_ì¶”ê°€=====ê¼­! í™•ì¸í•˜ê¸°!
//í† í”½ topic ì¶”ê°€ì‹œ return JSON Map (ì˜ˆìƒìˆ˜ì‹ ììˆ˜ ì •ë³´ í¬í•¨ã…‡)
	function fnAddTopic(){
      var noti_id="<%=noti_id%>"
        var topic_key=$('select[name="topic_key"]').val(); //ì²´í¬
        //console.log(topic_key)
		var topic_value=$('select[name="topic_value"]').val();
        
		var topic_search_val=$('input[name="topic_search"]').val();
        if(topic_value !== '' && topic_search_val !== '') {
            $('input[name="topic_search"]').focus()
            //ë¡œë”©
            ShowAjaxCover(true);
            //ì„œë²„ê²°ê³¼
            var result=mFnAddTopic(noti_id,topic_key,topic_value);
            $('ul#topic_list').empty();
            //ë¡œë”©ê±¸ê¸°
            if (Array.isArray(result.topics)) {
                console.log(result.topics)
                var listItems = result.topics.map(item => `<li>
                        <div style="width:60px;display:inline-block;font-weight:800">${item.type
                        }</div>${item.topic}
                        <a class="material-icons a_deleteTopic" topic_id="${item.id}">delete</a>
                    </li>`);
                   $('#topic_list').append(listItems.join(''));
                   fnSendTool(result)
            }
            ShowAjaxCover(false);
        }else{
            alert("ì£¼ì œ í‚¤ì›Œë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”")
            $('input[name="topic_search"]').focus()
        }
    }
    

//=====ë°œì†¡ìˆ˜ë‹¨info=====
function fnSendTool(result){
    $('.flex_div_info').empty();
    var flags = ["mail", "lms", "fcm", "kakao"];
    var filtered_flags = flags.filter(function(flag) {
        //ê²°ê³¼ê°’ì— ë”°ë¼ ìˆ˜ì •í•„ìš”(í”Œë˜ê·¸ê°’ ë°”ë¡œê°€ì ¸ì˜´)
    var flag_value = result.targets[flag]; 
    return flag_value <= 2;
    });
    var rows = filtered_flags.map(function(flag) {
        var flag_value = result.targets[flag];
        var checked = (flag_value == 1) ? " checked" : "";
        return `
            <ul class="sendInfo">
                <label for="${flag}_flag">
                <li>${flag}</li>
                <li>
                    <input class='flag_checkbox' type='checkbox' name='${flag}_flag' id='${flag}_flag' value='1'${checked}>
                </li>
                </label>
                <li>${result.targets[flag]}</li>
                <li><input id='${flag}_flag' name='${flag}_flag' class='sendNow_btn' type='button' value='ë°”ë¡œë°œì†¡'></li>
                <li>2023/11/07</li>
            </ul>`;
    });

    $('.flex_div_info').append(rows.join(''));
}

//=====í† í”½_ê°œë³„ì‚­ì œ=====
	$(document).on('click','.a_deleteTopic',function(){
		if (confirm('ì£¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
			var topic_id=$(this).attr('topic_id'); 
			var result=mFnDeleteTopic(topic_id);
            $('ul#topic_list').empty();
            if(result && Array.isArray(result.topics)){
                var listItems = result.topics.map(item => `<li><div style="width:60px;display:inline-block;font-weight:800">${item.type}</div> ${item.topic}<a class="material-icons a_deleteTopic" topic_id="${item.id}">delete</a></li>`);
                 $('ul#topic_list').append(listItems.join(''));
            } else {
               // console.log('result is not an array:', result);
            }
		}		
	})

//=====ì´ë¯¸ì§€_ëœë”=====
     function renderItems(items) {
        $("#ul_topicfile").empty();
        items.map(item => {
            $("#ul_topicfile").append(`
                <li>
                    <div style="background-image:url('${item.file_name}'); width: 200px; height: 200px; background-size: cover; background-position: center;" class="thumbnail w100 file_item" file_id="${item.file_id}" img_src="${item.file_name}"></div>
                    <a style=" margin-top:8px; display: block;" onclick="fnDeleteFile(event);"; class="material-icons file_del" file_id="${item.file_id}">delete</a>
                </li>
            `);
        });
    }
    
//=====íŒŒì¼_ì¶”ê°€=====
	 function fnAddFile(){
        //name
        var noti_id="<%=noti_id%>";
        var file_name=$('#noti_filename').val();
        if(!file_name){
            alert("íŒŒì¼ì„ ì—…ë¡œë“œ í›„ ì¶”ê°€í•´ì£¼ì„¸ìš”ğŸ˜…");
            $('#noti_filename').focus();
            return
        }
        var file_id='0';
        var file_ids='';
       var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
       $("#ul_topicfile").empty();
        renderItems(result)
     }

//=====ì´ë¯¸ì§€_ì‚­ì œ=====
     function fnDeleteFile(event){
        //id
        var noti_id="0";
        if(confirm("ì´ë¯¸ì§€ë¥¼ ì‚­ì œ í•˜ê² ìŠµë‹ˆê¹Œ?")){
            var file_id = $(event.currentTarget).attr('file_id');
            var file_name='';
            var file_ids='';
            var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
            renderItems(result);                 
        }
     }
    
//ê°™ì€ ë°°ì—´ ìˆœì„œì¼ë•Œ íë¥¼ ë‚ ë¦¬ì§€ ì•Šê²Œ ì„¸íŒ… í•„ìš”
//=====ì´ë¯¸ì§€_ì •ë ¬=====
    var preFile_ids=[];
     function fnSortFile(){
        //file_ids
        var noti_id="<%=noti_id%>";
        var file_ids=[];
        var file_name='';
        var file_id='0';
        $(".thumbnail").each(function(){
             var file_id = $(this).attr('file_id');
             if(file_id && !file_ids.includes(file_id)){ 
                    file_ids.push($(this).attr('file_id'));
             }
        });
        if(preFile_ids!==null && JSON.stringify(file_ids) !== JSON.stringify(preFile_ids)) {
             preFile_ids = file_ids.slice(); 
            file_ids=file_ids.join(',');    
            var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
            alert('ì •ë ¬_ì™„ë£Œ');
            renderItems(result);
        }else{
            alert('ê°™ì€ìˆœì„œì…ë‹ˆë‹¤');
        }
     }

    //========ì‹œê°„ì²´í¬=========
    function checkTime(){
        var due_date = new Date($('#due_date').val());
        var now = new Date();
        var hours = [10,11,12,13,14,15,16,17,18];
        hours.forEach(function(hour) {
            var radioBtn = $('#due' + hour);
            if(due_date.toDateString() == now.toDateString() && hour <= now.getHours()) {
                radioBtn.prop('disabled', true);
            }else{
                radioBtn.prop('disabled', false);
            }
        });
    }


</script>
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div class="modal-body">
        </div>
    </div>
</div>
<div class="div_title">
	<h1>í†µí•© ì•Œë¦¼ ê´€ë¦¬</h1>
</div>

    <%
    ' noti_id ê°’
    '*******ì…ë ¥ê°’********
    noti_id = Request("noti_id")
    if noti_id="" then noti_id="0"
      'Response.Write ("<h1>"& noti_id1 &"</h1>")
      '*******sql*******
      exeOption="V"

'ë””í´íŠ¸ ì„¸íŒ…
    due=12
    mail_flag="1"
    lms_flag="1"
    fcm_flag="1"
    kakao_flag="1"
    due_date=date

' SQL ë„£ê¸°
'noti_id ê°€ ë„˜ì–´ì˜¨ ê²½ìš° ê¸°ì¡´ ì •ë³´ë¥¼ select   /nvarchar Në„£ê¸°      
if cint(noti_id) >0 then
	set myNoti=new Notification
	myNoti.noti_id=noti_id
    set rs=myNoti.selectNotiInfo
	  	if not(rs.eof or rs.bof) then
			title=rs("title")  	
            noti_link=rs("noti_link")  	

			title_eng=rs("title_eng")  	
			title_chn=rs("title_chn")  	
			title_jpn=rs("title_jpn")  	
			sub_title=rs("sub_title")  	
			sub_title_eng=rs("sub_title_eng")  	
			sub_title_chn=rs("sub_title_chn")  	
			sub_title_jpn=rs("sub_title_jpn")  	
			mail_body=rs("mail_body")  	
			mail_body_eng=rs("mail_body_eng")  	
			mail_body_chn=rs("mail_body_chn")  	
			mail_body_jpn=rs("mail_body_jpn")  	
			lms_body=rs("lms_body")  	
			kakao_body=rs("kakao_body") 

			due_date=rs("due_date")  	
			due=rs("due")  	
			
            mail_flag=rs("mail_flag")  	
			lms_flag=rs("lms_flag")  	
			fcm_flag=rs("fcm_flag")  	
			kakao_flag=rs("kakao_flag")  	

			sent_date=rs("sent_date")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			'sent_date_lms=rs("sent_date_lms")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			'sent_date_fcm=rs("sent_date_fcm")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			'sent_date_kakao=rs("sent_date_kakao")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			
			
			dir_code=rs("dir_code")
			http=rs("http")
			file_name=rs("file_name")
            results=rs("results")
            
            

		end if 	
	  rs.Close
	  set rs=Nothing
	set myNoti=Nothing	  
end if	   

%>
<script>
 //=====ì„œë°‹=====
	function fnSubmit(exeOption){
		$('#exeOption').val(exeOption);
		var flag=false;
		exeOption=='D'?flag=confirm('ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'):flag=fnPreSubmit($('#formNoti'));
		if(flag){
			$('#formNoti').submit();
		}
	}

//=====ë‹¤íë¨¼íŠ¸ ë ˆë””=====
$(document).ready(function(){
    $('input[name="topic_search"]').on('keydown', function(e) {
   if (e.key === "Enter") fnSearchTopic();});
   
    $(".sortable").sortable();
    checkTime();
   $('#due_date').change(checkTime);

   //=====ì „ì†¡ì£¼ì œ&ê²€ìƒ‰ì–´ë¹„ìš°ê¸°=====
    $('select[name="topic_key"]').change(function() {
       $('select[name="topic_value"]').val('');
       $('input[name="topic_search"]').val('');
       $('input[name="topic_search"').focus();
   });
   
   //fnRenderTopic(mFnAddTopic(noti_id,'',''));
   function fnRenderTopic(array){}
   
   
   //=====íŒŒì¼_ì„¤ëª…=====
   $("body").on("click", ".file_item", function() {
       var file_id= $(this).attr('file_id'); 
       var noti_id="<%=noti_id%>";
       $.ajax({
           url: 'get_file_form.html',
           type: 'GET',
           data: { 
               'file_id': file_id,
                'noti_id': noti_id
           }
           })
           .done(function(res){
               $('.modal-body').html(res);
               $("#myModal").show();
           })
           .fail(function(jqXHR, textStatus, errorThrown){
               console.error('ì—ëŸ¬: ' + errorThrown);     
           })
           $(".close").click(function() {
               $("#myModal").hide();
           });
       //     $(window).click(function(event) {
       //         if ($(event.target).is("#myModal")) {
       //             $("#myModal").hide();
       //         }
       // })
   });

//======ì‚­ì œì‹œ_ í˜¸ë²„=========
$(document).on('mouseenter', '.file_del', function(){
       $(this).prev('.thumbnail').css('border', '4px solid rgba(222, 0, 0, 0.6)');
   }).on('mouseleave', '.file_del', function(){
       $(this).prev('.thumbnail').css('border', '');
   });

//========ë°”ë¡œì „ì†¡=========
 $(".sendNow_btn").click((noti_id,platform,notiType)=>{
    var noti_id="<%=noti_id%>";
    var platform='service'
    var notiType='mail'
		 if(platform === 'test') {
			var targets_val=document.querySelector("#targets").value;
            targets = targets_val ? targets_val.split(',').map(item => item.trim()).filter(item => item) : [];
            console.log(targets)
			 if(targets.length === 0) alert("ê°’ X");
		 }
         
        if(!confirm("ì‹¤ì œë¡œ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")){
            return;
        }
	    var result= mFnSendNoti(noti_id,platform,notiType);
            console.log(result)
        if(result.result=='OK'){
            alert("ë°œì†¡ì™„ë£Œ");
            //í™”ë©´ ë¦¬ë¡œë“œ
            location.reload(); 
            return noti_id
        }else{
            alert(result.message);
        }
 })

});



  

</script>
<form id="formNoti"  method="POST" action="set_noti_info.html" >
           noti_id <input type="text" value="<%=noti_id%>" name="noti_id" id="noti_id">
            <input type="hidden" value="<%=dir_code%>" name="dir_code" id="dir_code">
            <input type="text" name="exeOption" id="exeOption" readonly value="<%=exeOption%>">
            <table class="table_datagrid">
                <tr>
                    <th>ë§ í¬</th>
                    <td>
                        <input type="text" value="<%=noti_link%>" name="noti_link" id="noti_link" placeholder="ë§í¬ë¥¼ ì ì–´ì£¼ì„¸ìš”" title="ë§í¬ëŠ” ë°˜ë“œì‹œ ì…ë ¥ í•´ì•¼ í•©ë‹ˆë‹¤.">                     
                        <ul class="manual">
	                        <li>ì—°ê²°ì£¼ì†ŒëŠ” httpë¥¼ í¬í•¨í•œ ì „ì²´ì£¼ì†Œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
	                        <li>ë©”ì¼ë³¸ë¬¸, ì•±í‘¸ì‹œì•Œë¦¼ í´ë¦­ì‹œ ì—°ê²°ë¨</li>
	                        <li>ì–¸ì–´ì½”ë“œ í¬í•¨ë˜ì§€ ì•Šì€ ì£¼ì†Œ ì‚¬ìš©í•´ì•¼í•¨ ex) https://www.gvg.co.kr/item/123123</li>
	                        <li>ë°œì†¡ì–¸ì–´ì— ë”°ë¼ ì–¸ì–´ì½”ë“œëŠ” ìë™ìœ¼ë¡œ PLUS</li>
                        </ul>
                    </td>    
                </tr>
                <tr>
                    <th>ì œ ëª©</th>
                    <td>
                      <input type="text" value="<%=title%>" name="title" id="title" class="mustinput" placeholder="í•œêµ­ì–´ ì œëª©" title="í•œêµ­ì–´ ì œëª©ì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤."> 
                      <input type="text" id="title_eng" name="title_eng"  value="<%=title_eng%>" placeholder="ì˜ì–´ ì œëª©">
                      <input type="text"  id="title_chn" name="title_chn" value="<%=title_chn%>" placeholder="ì¤‘êµ­ì–´ ì œëª©">
                      <input type="text"  id="title_jpn" name="title_jpn" value="<%=title_jpn%>" placeholder="ì¼ë³¸ì–´ ì œëª©">
                      <ul class="manual">
	                      <li>ê¸´ë¬¸ìì˜ ê²½ìš° í•œêµ­ì–´ ì œëª©ë§Œ ì‚¬ìš©</li>
	                      <li>ê¸´ë¬¸ì ì œëª©ì€ í•œê¸€ê¸°ì¤€ ê³µë°±í¬í•¨ ìµœëŒ€ 20ì ê¹Œì§€ë§Œ ë³´ì—¬ì§.</li>
                      </ul>
                    </td>
                </tr>
                
                <tr>
                    <th>ì†Œì œëª©</th>
                    <td>
	                    <input type="text" name="sub_title" id="sub_title" value="<%=sub_title%>" placeholder="í•œêµ­ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_eng" name="sub_title_eng"  value="<%=sub_title_eng%>" placeholder="ì˜ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_chn" name="sub_title_chn"  value="<%=sub_title_chn%>" placeholder="ì¤‘êµ­ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_jpn" name="sub_title_jpn"  value="<%=sub_title_jpn%>" placeholder="ì¼ë³¸ì–´ ì†Œì œëª©">
	                </td>
                </tr>
                <tr>
                    <th>ì¸ë„¤ì¼</th>
                    <td>
	                    <input id="file_name" dir_code="<%=dir_code%>" type="text" name="file_name" value="<%=file_name%>">
						<a class="btn3 small a_upload" onclick="OpenUploader($(this).prev());">ì—…ë¡œë“œ</a>
						<a <%if file_name <> "" then response.write " href="""&http&"/"&file_name&" "" target=""_blank"" " %> class="btn3 small a_preview" >ë³´ê¸°</a>
						<a class="btn3 small a_delimg">ì‚­ì œ</a>
						<ul class="manual">
							<li>ë©”ì¼ë³¸ë¬¸ ìµœìƒë‹¨ì— ì‚¬ìš©ë¨</li>
	                        <li>ì•±í‘¸ì‹œë°œì†¡ì— ì‚¬ìš©ë¨.</li>
	                        <li>ê°€ë¡œ 700px ì´ìƒ</li>
                        </ul>
	                </td>
                </tr>
                <tr>
                    <th>ë©”ì¼ë³¸ë¬¸</th>
                    <td><textarea name="mail_body" id="mail_body" cols="60" rows="10"><%=mail_body%></textarea>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì˜ì–´</th>
                    <td><textarea name="mail_body_eng" id="mail_body_eng" cols="60" rows="10" ><%=mail_body_eng%></textarea></td>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì¤‘êµ­ì–´</th>
                    <td><textarea name="mail_body_chn" id="mail_body_chn" cols="60" rows="10"><%=mail_body_chn%></textarea></td>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì¼ë³¸ì–´</th>
                    <td><textarea name="mail_body_jpn" id="mail_body_jpn" cols="60" rows="10"><%=mail_body_jpn%></textarea></td>
                    
                </tr>
                <tr>
                    <th>LMS</th>
                    <td>
                        <textarea name="lms_body" id="lms_body" cols="60" rows="10"><%=lms_body%></textarea>
                        <ul class="manual">
	                        <li>" [Webë°œì‹ ], [ê´‘ê³ ], ìˆ˜ì‹ ê±°ë¶€ " ëŠ” ìë™ì²¨ë¶€ì´ë¯€ë¡œ LMSë‚´ìš©ì— ë„£ì§€ ë§ˆì„¸ìš”</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th>ì¹´ì¹´ì˜¤</th>
                    <td><textarea name="kakao_body" id="kakao_body" cols="60" rows="10"><%=kakao_body%></textarea></td>
                </tr>
                <tr>
                    <th>ì˜ˆì•½ë‚ ì§œ</th>
                    <td><input type="date" name="due_date" id="due_date" value="<%=due_date%>"></td>
                </tr>
                <tr>
                    <th>ë°œì†¡ì‹œê°„</th>
                    <td id="radioGroup">
                    <%
                    hours=Array(10,11,12,13,14,15,16,17,18)
                    if noti_id <= 0 then
                        due=11
                    end if
                        curHour=Hour(Now())
                        For Each i In hours
                            Response.Write("<input type='radio' name='due' id='due" & i & "' value='" & i & "'")
                            If due = i Then Response.Write(" checked")
                            If i < curHour Then Response.Write(" disabled")
                                Response.Write(" style=""margin-left:20px;"">")
                                Response.Write("<label for ='due" & i & "' style='display:inline-block;'>" & i & "ì‹œ </label>")
                        Next
                        %>                 
                    </td>
                </tr>
                <tr>
                    <th>ë°œì†¡ìˆ˜ë‹¨</th>
                    <td>
                    <div class="flex_div">
                        <ul id="sendTool">
                            <li>ë°œì†¡ìˆ˜ë‹¨</li>
                            <li>ë°œì†¡ì—¬ë¶€</li>
                            <li>ë°”ë¡œë°œì†¡</li>
                            <li>ì˜ˆìƒìˆ˜ì‹ ì</li>
                            <li>ë°œì†¡ì¼ì</li>
                        </ul>
                    </div><br>
                   <div class="flex_div_info">
                    <%
                        flags = Array("mail", "lms", "fcm", "kakao")
                         For Each flag In flags
                           if cint(Eval(flag & "_flag")) <= 2 then 
                                Response.Write("<ul class='sendInfo'>")
                                Response.Write("<label for='" & flag & "_flag'>") ' ë¼ë²¨ ì‹œì‘
                                Response.Write("<li>"&flag&"</li>")
                                Response.Write("<li>")
                                Response.Write("<input class='flag_checkbox' type='checkbox' name='" & flag & "_flag' id='" & flag & "_flag' value='1'")
                                If Eval(flag & "_flag") = 1 Then 
                                    Response.Write(" checked")
                                ElseIf Eval(flag & "_flag") = 0 Then
                                    Response.Write("")
                                End If
                                Response.Write("></label>") ' ë¼ë²¨ ë
                                Response.Write("</li>")
                                Response.Write("<li><input id='" & flag & "_flag' name='" & flag & "_flag' class='sendNow_btn' type='button' value='ë°”ë¡œë°œì†¡'></li>")
                                Response.Write("<li>"& hello &"</li>")
                                Response.Write("<li>"& sent_date &"</li>")
                                Response.Write("</ul>")
                            end if
                        Next
                    %>


                                
                </tr>
                  <%
' 	                  set myTopic=new Notification
' 	                  myTopic.noti_id=noti_id
'                       If noti_id>0 Then
'                       set topicRs=myTopic.selectTopicInfo  
                  %>
                <tr>
                  <th>ì „ì†¡ ì£¼ì œ</th>
                  <td>
                    <select name="topic_key" title="ì£¼ì œë¥¼ ì„ íƒí•˜ë©´ í† í”½ì„ ê³ ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
	                    <option value="pcs_id" selected>ìƒí’ˆì½”ë“œ</option>
                        <option value="pcs_maker">ë¸Œëœë“œ</option>
                        <option value="idol_id">ì•„ì´ëŒ</option>
                        <option value="unit_id">ìœ   ë‹›</option>
                    </select>
                    <select name="topic_value"></select>
                    <input type="text" name="topic_search" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" title="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥ ë˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ë³€ê²½ í›„ ê²€ìƒ‰ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”">
                    <a onclick="fnSearchTopic()" class="btn3 big material-icons">search</a>
                    <a onclick="fnAddTopic()" id="a_addTopic" class="btn3 big material-icons">add</a>
					<div class="pd30">
						<ul id="topic_list">
							<%
							sub temp()	
								if not(topicRs.eof or topicRs.bof)	 then
									do until topicRs.eof
									%>
									<li>
	                                    <div style="width:60px;display:inline-block;font-weight:800"><%=topicRs("topic_type")%></div> <%=topicRs("topic")%>
	                                    <a class="material-icons a_deleteTopic" topic_id="<%=topicRs("topic_id")%>">delete</a>
	                                    
	                                </li>
									<%
									topicRs.MoveNext
									Loop	
								end if	
							end sub
							%>
						</ul>
					</div>
                  </td>
                  <%
	                ' topicRs.Close
	                ' set topicRs=nothing                        
                   ' End if
	                 set myTopic=Nothing 
                  %>
                </tr>
                    <%
                        set myFile=new Notification
                        myFile.noti_id=noti_id
                        myFile.file_id=file_id
                        If noti_id>0 Then
                        set fileRs=myFile.selectfileInfo
                    %>
                    <tr>
                        <th>ì²¨ë¶€íŒŒì¼</th>
                        <td>   
                            <input id="noti_filename" dir_code="<%=dir_code%>" type="text" name="noti_filename">
                            <a class="btn3 small a_upload" onclick="OpenUploader($(this).prev());">ì—…ë¡œë“œ</a>
                            <a <%if file_name <> "" then response.write " href="""&http&"/"&file_name&" "" target=""_blank"" " %> class="btn3 small a_preview" >ë³´ê¸°</a>
                            <a class="btn3 small a_delimg">ì‚­ì œ</a>
                            <a style="font-weight:bolder; margin-left:3px" onclick="fnAddFile()"class="btn2 small">ì¶”ê°€</a>
                            <a style="background-color: red; margin-left: 18px;" onclick="fnSortFile()"class="btn4 small">ìˆœì„œì •ë ¬</a>
                            <ul class="manual">
		                        <li>ê°€ë¡œ 700px ì´ìƒ</li>
		                        <li>ìˆœì„œ ë³€ê²½í›„ ë°˜ë“œì‹œ "ìˆœì„œì •ë ¬" í´ë¦­í•´ì„œ ë°˜ì˜ì‹œì¼œì•¼ í•¨</li>
	                        </ul>
                        <div class="pd30">
                            <ul class="sortable" id="ul_topicfile">
                                        <%
                                        if not(fileRs.eof or fileRs.bof) then	
                                            do until fileRs.EOF
                                                if fileRs("file_name") <> "" then
                                                %>
                                                <li>                                                    
                                                    <div style="margin-left: 3px; background-image:url('<%=fileRs("http")%>/<%=fileRs("file_name")%>'); width: 200px; height: 200px; background-size: cover; background-position: center;" class="thumbnail w100 file_item" file_id="<%=fileRs("file_id")%>" img_src="<%=fileRs("http")%>/<%=fileRs("file_name")%>"></div>
                                                    <a style="margin-top: 12px;" onclick="fnDeleteFile(event)"; class="material-icons file_del" file_id="<%=fileRs("file_id")%>">delete</a>
                                                </li>
                                                <%
                                                end if
                                            fileRs.MoveNext
                                            Loop
                                        end if
                                        %>
                            </ul>
                        </div>
                        
                        <%
                        fileRs.Close
                        set fileRs=nothing
                        set myFile=Nothing 
                        %>
                    </td>
                </tr>
                <tr>
                    <th>ì‹¤ì œ ì „ì†¡ë‚ ì§œ</th>
                    <td><input type="datetime" name="sent_date" id="sent_date" readonly value="<%=sent_date%>"></td>
                </tr>
                <tr>
                <th>ë°œì†¡_ê²°ê³¼</th>
                <td>
                    <%
                        Response.Write convertChar(results)
                    %> 
                  </td>
                </tr>
                <%End if
                %>
            </table>     
            <div class="pd30">
				<a class="btn2 biggest" href="noti_list.html">ëª©ë¡ë³´ê¸°</a>
				<a class="btn2 biggest" onclick="fnSubmit('D');">ì‚­ì œí•˜ê¸°</a>
                <% if noti_id > 0 then Response.Write("<a style='margin-left: 25px;' class='btn2 biggest' href='get_noti_preview.html?noti_id=" & noti_id & "' target='_blank'>ë¯¸ë¦¬ë³´ê¸°</a>") %>
                <a style="margin-left: 3px;" id="saveBtn" class="btn3 biggest" onclick="fnSubmit()" >ì €ì¥í•˜ê¸°</a>
            </div>
    </form>