class myShop{
    constructor(data) { // ìƒì„±ì í˜¸ì¶œ
        var myshop_id;
        var board_title;
        var board_id;
        var board_desc;
        var pcs_ids;
        var pcs_image;
        var pcs_name;
        var result;
        var status;
        var style;
        //ë”ë¯¸
        var my_result;

        
        
        this.myshop_id = data.myshop_id;
        this.board_title = data.board_title;
        this.board_id = data.board_id;
        this.board_desc = data.board_desc;
        this.pcs_ids = data.pcs_ids;
        this.pcs_image = data.pcs_image;
        this.pcs_name = data.pcs_name;
        this.status = data.status;
        this.style = data.style;
        this.modalContent='';

    }


    //ë‚´ ë³´ë“œ ëª©ë¡ ë¦¬í„´ 
	getBoardList() {
        return $.ajax({ 
            type: "GET",
            url: "/myshop/ajax/get_board_list.asp",
            traditional: true,
            data: {'pcs_ids': [this.pcs_ids]},  
            dataType: "json"
        }).success((result) => {
            this.pcs_image = result.pcs[0].pcs_image;
            this.pcs_name = result.pcs[0].pcs_name;
        }).error(function(response, textStatus, errorThrown) {
            alert(errorThrown);
        }); 
    }

    //ë³´ë‚¼ë•Œ: ë§ˆì´ìƒµ_id/  {board_id/ title/ des}, style, status,
    //desì´ í…ìŠ¤íŠ¸ì—ë¦¬ì–´
    //user_id	myshop_id	myshop_domain	myshop_title	myshop_desc	sysdate	status
    getMasterInfo(){
        my_result={
            "myshop_id":22,
            "myshop_title":"HanaRo",
            "myshop_desc":"è¡£æœåœ¨è¿™é‡Œå°±ç©¿ä¸€ä»¶",
            "board":[
              {
                "board_id":1,
                "board_title":"Accessory",
                "board_desc":"ì•…ì„¸ì‚¬ë¦¬",
              },
              {
                "board_id":2,
                "board_title":"ãƒ†ãƒ†ã®å†¬ğŸ’œ",
                "board_desc":"ã‚¢ãƒŸã®ãŸã‚ã®ãŠã™ã™ã‚ğŸ’œ",
              },             
              {
                "board_id":3,
                "board_title":"EoljuK-A",
                "board_desc":"Hot Summer ì–¼ì£½ì•„ í•«ì—¬ë¦„ ì„¸ì¼! ì£½ì§€ ì•ŠëŠ” ë‚´ë…„ ì—¬ë¦„í…œ, ë¯¸ë¦¬ë¯¸ë¦¬ í•«í•œ ê°€ê²©ìœ¼ë¡œ HanaRo Select shopì—ì„œ ì¦ê²¨ë³´ì„¸ìš”! ë°”ìº‰ìŠ¤ë¥¼ ë– ë‚  ì¤€ë¹„ëŠ” ë˜ì…¨ë‚˜ìš”? HanaRo Select shopì´ í•¨ê»˜í•©ë‹ˆë‹¤! #ì—¬ë¦„í…œ #ì–¼ì£½ì•„ #Sale for iced americano",
              },             
            ],
            "style":{
                "bg_color":"#ccc",
                "border":"#00af35"
            }
        }
        //ë”ë¯¸       
        alert(my_result);
        // return this.my_result
        
        // return $.ajax({ 
        //     type: "GET",
        //     url: "/myshop/setting/index.html",
        //     data: this.myshop_id,
        //     dataType: "json"
        // }).success(function(result) {
        //     this.my_result;
        // }). error(function(response, textStatus, errorThrown) {
        //     alert(errorThrown)
        // }); 
    }
    

	//ìƒˆë¡œìš´ë³´ë“œ ë§Œë“¤ì–´ì„œ ìƒí’ˆ ë„£ê¸°
	// { "resp":"OK",  "pcs_count":1,  "resp_message":"ADDED SUCCESSFULLY",  "status":"ADD" }
    //On ìƒíƒœëŠ” ì¢€ ë” ê³ ë¯¼í•´ ë³´ê¸°
	setBoardInfo() {
        if (!this.pcs_ids || this.pcs_ids === '') {
            alert('ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.');
            return; 
        }
        //this.selectPcs()
        $.ajax({
            type: "GET",
            url: "/myshop/ajax/set_myshop_pcs.asp",
            data: {
                'board_id': this.board_id,
                'pcs_ids': this.pcs_ids,    
                'status': this.status,
                'board_title': this.board_title
            },
            context: this,
            success: function(item) {
                var data = JSON.parse(item);
             //   alert(JSON.stringify(data))
                if(data.resp === 'OK') {
                    switch (data.status) {
                        case 'ADD':
                            if (this.status === 'ADD' && this.board_id === 0) {
                                this.board_id = this.NewBoardId();
                            }
                            this.selectPcs();
                            break;
                        case 'ON':
                            $('.mspPcsList>li.selected').removeClass('inActive');
                            break;
                        case 'OFF':
                            $('.mspPcsList>li.selected').addClass('inActive');
                            break;
                        case 'REMOVE':
                            if (confirm(`${this.pcs_ids.split(',').length}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                                $('.mspPcsList>li.selected').remove();
                            }
                            break;
                        default:
                            console.log('resp_message:', data.resp_message);
                    }
                }else {
                    alert('Error: ' + data.resp_message);
                }
            },
            error: function(response, textStatus, errorThrown) {
                alert(errorThrown);
            }
        });
    }


    
	//ë§ˆì´ìƒµì— ì•„ì´í…œ ì¶”ê°€ì‹œ íŒì—…
	OpenModal(){
        $("#div_popup").css({
            "display": "flex",
            "align-items": "center",
            "justify-content": "center",
            
        });
        $('.a_close.outside').css({
            "position": 'absolute',
            'top': '85',
            'right': '160'
        });
        $('#div_popup>div').css({
            'border-radius': '9'
        });
        $('#div_cover').fadeIn();
		$('#div_popup').show();
		$('#div_popup>div').html('');
		$("#div_popup>div").html(this.modalContent);
	}

       //ì„ íƒìƒí’ˆ ë³´ì—¬ì£¼ê¸°
       selectPcs(){
        var content=`
        <div style="margin: 8px 12px 98px 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 200px; position:relative; width:200px;">
            <div style="position:relative; width:150px; height:150px;">
                <div class="psc_imge" style="background-image: url('${this.pcs_image}'); width: 150px; height: 150px; background-size: cover"></div>
                <p style="margin-left:-5px; margin-bottom:15px; margin-top:5px; word-wrap: break-word;">${this.pcs_name}</p>   
            <div style="margin-bottom:15px;">
                <a style="display: inline-block;" class="gotoBtn btn1 biggest">Go Myshop</a>&nbsp
                <a style="display: inline-block;" class="closeBtn btn1 biggest">X</a>
            </div>              
        </div>
            `;
        this.modalContent=content;
       	this.OpenModal();
    }


    //ê¸°ì¡´ë³´ë“œ ë³´ì—¬ì£¼ê¸°
    showBordList() {
        this.getBoardList().done((result) => {
            var content = `
                <div style="margin: 12px 18px 98px 24px; display: flex; flex-direction: column; align-items: center; padding-left: 23px; padding-right: 17px;">
                    <h2 style=" margin-bottom:8px;" id="myshop_title">${result.myshop_title} </h2>
                        <div style="position:relative; width:150px; height:150px;">
                            <div class="psc_imge" style="background-image: url('${result.pcs[0].pcs_image}'); width: 150px; height: 150px; background-size: cover"></div>
                        <p style="width:160px; margin-left: -15px; margin-top: 6px; margin-bottom:14px; word-wrap: break-word; ">${result.pcs[0].pcs_name}</p>    
                        <ul class="board_list" style="padding: 0; text-align: left;">
                        ${
                            result.data && result.data.length > 0 ? 
                            result.data.map(board => `
                                <li>
                                    <h3>
                                        <a style="font-size:15px;" board_id="${board.board_id}" class="board-title" onclick="setBoardInfo(${board.board_id}, ${this.pcs_ids}, 'ADD');">${board.board_title}</a>
                                    </h3>
                                </li>
                            `).join('') : '<li>NO BOARD</li>'
                        }
                        </ul>   
                        <div style="padding-bottom:20px; display: flex; margin-bottom:10px; align-items: center; justify-content: center;">   
                            <input type="text" id="board_title" style="display: inline-block;">
                            <a id="a_addToNew" class="btn1 biggest" style="display: inline-block;">+</a>
                        </div>
                    </div>
                </div>
            `;
        this.modalContent=content;
       	this.OpenModal();
        }).fail((jqXHR, textStatus, errorThrown) => {
            console.log(textStatus, errorThrown);
        });
    }


//ì•ˆë ê²ƒ ê°™ì•„ã…œ ë‚˜ì¤‘ì— ìˆ˜ì •í•˜ê¸°
    NewBoardId() {
        var lastBoardId = $('ul.board_list a.board-title:last').attr('board_id');
        return lastBoardId ? parseInt(lastBoardId) + 1 : 0;
    }
    
}//endC



var ms = new myShop({});

	$(document).on('click', '.a_toggleMyshop', function () {
		ms.pcs_ids=$(this).attr('pcs_id'),
		ms.showBordList();
	});

	$(document).on('click', '.board-title', function () {
		ms.board_id=$(this).attr('board_id');
		ms.board_title='';
		ms.status='ADD';
		ms.setBoardInfo();
	});


	//.a_ManagePcs on/off/ remove(staus value)
	// .mspPcsList>li.selected   attr('pcs_id')[arry] request/response 
	//board pcs admin menu
	$(document).on('click', '.a_ManagePcs', function () {
	    ms.pcs_ids=$('.mspPcsList>li.selected').map(function() {
            return $(this).attr('pcs_id');
        }).get().join(',');
	    ms.board_id=$(this).attr('board_id');
	    ms.status=$(this).attr('status');
        ms.board_title="";
        ms.setBoardInfo();
	});


	$(document).on('click', '#a_addToNew', function () {
		var board_title=$('#board_title').val();
		if(board_title){
			ms.board_id=0;
			ms.board_title=board_title;
			ms.status='ADD';
			ms.setBoardInfo();
		}else{
			alert('no title');
		}
	});
	
	$(document).on('click', '.gotoBtn', function () {
	    //ë„˜ê²¨ì£¼ëŠ” ê²ƒ ë³´ë“œid,
	    window.location.href =`http://bak2.gvg.co.kr/myshop/?board=${ms.board_id}`;   
	 });

	 $(document).on('click', '.closeBtn', function () {
	    $('#div_cover').hide();
		$('#div_popup').hide();
	 });

     //ì—¬ê¸°ì„œ ë„íë¨¼íŠ¸ë ˆë”” ë„˜ê²¨ë„ ë˜ë‚˜?
     
