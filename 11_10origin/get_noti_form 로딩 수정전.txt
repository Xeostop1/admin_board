<!--#include virtual=/inc/dev/vbutil.inc-->
<!--#include virtual=/inc/dev/top.inc-->
<!--#include virtual=/classes/notification.asp--> 

<%	
admin_id="mars1030"	
dir_code="501"
noti_id = Request("noti_id")
admin_id = Request("admin_id")

pvType=Request("pvType")
pvLang=Request("pvLang")
%>
<style>
	.table_datagrid th{width:100px;height:inherit}
	.table_datagrid td{text-align:left;}
	textarea{height:100px;}
	.sortable { list-style-type: none; margin: 0; padding: 0; width: 100%; }
	.sortable li { margin: 3px 3px 3px 0; padding: 1px; float: left;  font-size: 4em; text-align: center; cursor:move}

    .flex_div table td{text-align: center;}
    .flex_div table td a{width: 70px; height: 36px; line-height: 25px; border-radius: 5px;}
    body input{ font-size: 13px;}
    body textarea{font-size: 13px;}
    body table th{font-size: 14px;}
    .manual li{font-size: 13px;} 
    /* ëª¨ë‹¬ */
    .modal {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.4);
      }
      
      .modal-content {
        background-color:#fefefe;
        margin: 10% auto;
        padding:20px;
        border :3px solid #888;
        border-radius :10px ;
        width :50% ;
        max-height: 70vh; 
        overflow-y: auto    
      }
      .close{
       cursor:pointer ;
       float:right ;
       font-size :28px ; 
       font-weight:bold ; 
      }
</style>
<script src="/jquery/noti.js"></script>
<script>


//=====í† í”½_ê²€ìƒ‰=====
	function fnSearchTopic(){    
        $('select[name="topic_value"]').empty();   
		noti_id="<%=noti_id%>"
        var topic_key=$('select[name="topic_key"]').val();
		var topic_value=$('select[name="topic_value"]').val();
		var topic_search=$('input[name="topic_search"]').val();
        var result=mFnSearchTopic(noti_id,topic_key,topic_search);
        var target=$('select[name="topic_value"]'); 
        var options = $.map(result, item => `<option value="${item.value}">${item.text}</option>`).join('');
        target.append(options);
	}

//=====í† í”½_ì¶”ê°€=====
//í† í”½ topic ì¶”ê°€ì‹œ return JSON Map (ì˜ˆìƒìˆ˜ì‹ ììˆ˜ ì •ë³´ í¬í•¨ã…‡)
	function fnAddTopic(){
        var noti_id="<%=noti_id%>"
        var topic_key=$('select[name="topic_key"]').val();  
		var topic_value=$('select[name="topic_value"]').val();
		var topic_search_val=$('input[name="topic_search"]').val();

        if(topic_value !== '' && topic_search_val !== '') {
          //  $('input[name="topic_search"]').focus()
         //   ShowAjaxCover(true);
            //ì„œë²„ê²°ê³¼
            var result=mFnAddTopic(noti_id,topic_key,topic_value);
            $('ul#topic_list').empty();
            //í† í”½ëœë”ë§
            fnRenderTopic(result)
          //  ShowAjaxCover(false);
        }else{
            alert("ì£¼ì œ í‚¤ì›Œë“œë¥¼ ë„£ì–´ì£¼ì„¸ìš”")
            $('input[name="topic_search"]').focus()
        }
    }

   //fnRenderTopic(mFnAddTopic(noti_id,'',''));
   //=======í† í”½, ë°œì†¡ìˆ˜ë‹¨ ë Œë”ë§=======
   function fnRenderTopic(result){

    var topic_list=$("#topic_list");
    var target_list=$(".target_list")
    target_list.empty();

    //ìˆ˜ì •
    if(!result){
        ShowAjaxCover(false);
    }


    $.each(result.topics, function(i, topic) {
        var li=$('<li>')
        var div=$(`<div style="width:60px;display:inline-block;font-weight:800">${topic.type}</div>`)
        var a=$(`<a class="material-icons a_deleteTopic" topic_id="${topic.id}">delete</a>`);
        li.append(div, ` ${topic.topic} `, a);
        topic_list.append(li);
    });
    $.each(result.targets, function(target, value){
        if (target === 'email') {
            $("#mail_target").append(value);
        } else if (target === 'lms') {
            $("#lms_target").append(value);
        } else if (target === 'fcm') {
            $("#fcm_target").append(value);
        }
    })
}

//=====í† í”½_ê°œë³„ì‚­ì œ=====
	$(document).on('click','.a_deleteTopic',function(){
		if (confirm('ì£¼ì œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){
			var topic_id=$(this).attr('topic_id'); 
			var result=mFnDeleteTopic(topic_id);
            $('ul#topic_list').empty();
            if(result && Array.isArray(result.topics)){
                var listItems = result.topics.map(item => `
                <li>
                    <div style="width:60px;display:inline-block;font-weight:800">${item.type}</div> 
                    ${item.topic}
                    <a class="material-icons a_deleteTopic" topic_id="${item.id}">delete</a>
                </li>`);
                 $('ul#topic_list').append(listItems.join(''));
            }
		}		
	})

//=====ì´ë¯¸ì§€_ëœë”=====
     function renderItems(items) {
        $("#ul_topicfile").empty();
        items.map(item => {
            $("#ul_topicfile").append(`
                <li>
                    <div style="background-image:url('${item.file_name}'); 
                                width: 200px; 
                                height: 200px; 
                                background-size: cover; 
                                background-position: center;" 
                                class="thumbnail w100 
                                file_item" file_id="${item.file_id}"
                                img_src="${item.file_name}">
                    </div>
                    <a style=" margin-top:8px; display: block;" 
                            onclick="fnDeleteFile(event);"; 
                            class="material-icons file_del" 
                            file_id="${item.file_id}">
                     delete
                    </a>
                </li>
            `);
        });
    }
    
//=====íŒŒì¼_ì¶”ê°€=====
	 function fnAddFile(){
        //name
        var noti_id="<%=noti_id%>";
        var file_name=$('#noti_filename').val();
        if(!file_name){
            alert("íŒŒì¼ì„ ì—…ë¡œë“œ í›„ ì¶”ê°€í•´ì£¼ì„¸ìš”ğŸ˜…");
            $('#noti_filename').focus();
            return
        }
        var file_id='0';
        var file_ids='';
       var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
       $("#ul_topicfile").empty();
        renderItems(result)
     }

//=====ì´ë¯¸ì§€_ì‚­ì œ=====
     function fnDeleteFile(event){
        //id
        var noti_id="0";
        if(confirm("ì´ë¯¸ì§€ë¥¼ ì‚­ì œ í•˜ê² ìŠµë‹ˆê¹Œ?")){
            var file_id = $(event.currentTarget).attr('file_id');
            var file_name='';
            var file_ids='';
            var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
            renderItems(result);                 
        }
     }
    
//=====ì´ë¯¸ì§€_ì •ë ¬=====
    var preFile_ids=[];
     function fnSortFile(){
        //file_ids
        var noti_id="<%=noti_id%>";
        var file_ids=[];
        var file_name='';
        var file_id='0';
        $(".thumbnail").each(function(){
             var file_id = $(this).attr('file_id');
             if(file_id && !file_ids.includes(file_id)){ 
                    file_ids.push($(this).attr('file_id'));
             }
        });
        if(preFile_ids!==null && JSON.stringify(file_ids) !== JSON.stringify(preFile_ids)) {
             preFile_ids = file_ids.slice(); 
            file_ids=file_ids.join(',');    
            var result=mFnSetFileInfo(noti_id,file_id,file_name,file_ids);
            alert('ì •ë ¬ ì™„ë£Œ');
            renderItems(result);
        }else{
            alert('ê°™ì€ìˆœì„œì…ë‹ˆë‹¤');
        }
     }

    //========ì‹œê°„ì²´í¬=========
    function checkTime(){
        var due_date = new Date($('#due_date').val());
        var now = new Date();
        var hours = [10,11,12,13,14,15,16,17,18];
        hours.forEach(function(hour) {
            var radioBtn = $('#due' + hour);
            if(due_date.toDateString() == now.toDateString() && hour <= now.getHours()) {
                radioBtn.prop('disabled', true);
            }else{
                radioBtn.prop('disabled', false);
            }
        });
    }
    
</script>
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <div style="height:400px;" class="modal-body">
        </div>
    </div>
</div>
<div class="div_title">
	<h1 style="font-size: 30px;">í†µí•© ì•Œë¦¼ ê´€ë¦¬</h1>
</div>

    <%
    ' noti_id ê°’
    '*******ì…ë ¥ê°’********
    noti_id = Request("noti_id")
    if noti_id="" then noti_id="0"
      'Response.Write ("<h1>"& noti_id1 &"</h1>")
      '*******sql*******
      exeOption="V"

'ë””í´íŠ¸ ì„¸íŒ…
    due=12
    mail_flag="1"
    lms_flag="1"
    fcm_flag="1"
    kakao_flag="1"
    due_date=date

' SQL ë„£ê¸°
'noti_id ê°€ ë„˜ì–´ì˜¨ ê²½ìš° ê¸°ì¡´ ì •ë³´ë¥¼ select   /nvarchar Në„£ê¸°      
if cint(noti_id) >0 then
	set myNoti=new Notification
	myNoti.noti_id=noti_id
    set rs=myNoti.selectNotiInfo
	  	if not(rs.eof or rs.bof) then
			title=rs("title")  	
            noti_link=rs("noti_link")  	

			title_eng=rs("title_eng")  	
			title_chn=rs("title_chn")  	
			title_jpn=rs("title_jpn")  	
			sub_title=rs("sub_title")  	
			sub_title_eng=rs("sub_title_eng")  	
			sub_title_chn=rs("sub_title_chn")  	
			sub_title_jpn=rs("sub_title_jpn")  	
			mail_body=rs("mail_body")  	
			mail_body_eng=rs("mail_body_eng")  	
			mail_body_chn=rs("mail_body_chn")  	
			mail_body_jpn=rs("mail_body_jpn")  	
			lms_body=rs("lms_body")  	
			kakao_body=rs("kakao_body") 

			due_date=rs("due_date")  	
			due=rs("due")  	
			
            mail_flag=rs("mail_flag")  	
			lms_flag=rs("lms_flag")  	
			fcm_flag=rs("fcm_flag")  	
			kakao_flag=rs("kakao_flag")  	

			sent_date=rs("sent_date")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			sent_date_lms=rs("sent_date_lms")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			sent_date_fcm=rs("sent_date_fcm")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			sent_date_kakao=rs("sent_date_kakao")  	 'ì´ë©”ì¼ ë°œì†¡ì¼ì‹œ
			
			
			dir_code=rs("dir_code")
			http=rs("http")
			file_name=rs("file_name")
            results=rs("results")
            
		end if 	
	  rs.Close
	  set rs=Nothing
	set myNoti=Nothing	  
end if	   

%>

<script> 
 //=====ì„œë°‹=====
function fnSubmit(exeOption){
    $('#exeOption').val(exeOption);
    var flag=false;
    exeOption=='D'?flag=confirm('ì‚­ì œ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?'):flag=fnPreSubmit($('#formNoti'));
    if(flag){
        $('#formNoti').submit();
    }
}
//=====ë‹¤íë¨¼íŠ¸ ë ˆë””=====
$(document).ready(function(){
   // ShowAjaxCover(true);
    $('input[name="topic_search"]').on('keydown', function(e) {
   if (e.key === "Enter") fnSearchTopic();});
    $(".sortable").sortable();
    checkTime();
   $('#due_date').change(checkTime);

   //=====ì „ì†¡ì£¼ì œ&ê²€ìƒ‰ì–´ë¹„ìš°ê¸°=====
    $('select[name="topic_key"]').change(function() {
       $('select[name="topic_value"]').val('');
       $('input[name="topic_search"]').val('');
       $('input[name="topic_search"').focus();
   });

   

   //=====ì´ë¯¸ì§€ ì œëª© ë° ì„¤ëª… í´ë¦­=====
   $("body").on("click", ".file_item", function() {
       var file_id= $(this).attr('file_id'); 
       var noti_id="<%=noti_id%>";
       $.ajax({
           url: 'get_file_form.html',
           type: 'GET',
           data: { 
               'file_id': file_id,
                'noti_id': noti_id
           }
           })
           .done(function(res){
               $('.modal-body').html(res);
               $("#myModal").show();
               $(document).on('keydown', escExit);
           })
           .fail(function(jqXHR, textStatus, errorThrown){
               console.error('ì—ëŸ¬: ' + errorThrown);     
           })
           $(".close").click(function() {
               $("#myModal").hide();
           });
           var escExit=function(event){
            if(event.keyCode==27){
                $("#myModal").hide();
                $(document).off('keydown', escExit);
            }
           }
   });

//======ì‚­ì œì‹œ_ í˜¸ë²„=========
$(document).on('mouseenter', '.file_del', function(){
       $(this).prev('.thumbnail').css('border', '4px solid rgba(222, 0, 0, 0.6)');
   }).on('mouseleave', '.file_del', function(){
       $(this).prev('.thumbnail').css('border', '');
   });

//========ë°”ë¡œì „ì†¡=========
 $(".sendNow_btn").click(function(){
    var noti_id="<%=noti_id%>";
    var platform='service'
    var mail_flag="<%=mail_flag%>";
    var lms_flag="<%=lms_flag%>";
    var fcm_flag="<%=fcm_flag%>";
    var notiType=$(this).data('noti-type');
    //alert(notiType)
     if(confirm('ì¦‰ì‹œ ë°œì†¡í•˜ê² ìŠµë‹ˆê¹Œ? / ë°œì†¡ ì¤‘ì—ëŠ” ìƒˆë¡œê³ ì¹¨ì´ë‚˜ í™”ë©´ì´ë™ *ì¡°ì‘ê¸ˆì§€')){
        //ShowAjaxCover(true);
        var url = `send.html?noti_id=${noti_id}&pvType=${notiType}&platform=${platform}`;
        window.open(url, '_blank', 'height=500,width=500,status=yes,toolbar=no,menubar=no,location=no');
        //ShowAjaxCover(false);    
    }else{
        alert("ë°œì†¡ì„ ì·¨ì†Œí•˜ì˜€ìŠµë‹ˆë‹¤.")
    }
})
});
   //mFnAddTopicê²°ê³¼ê°’ ë°”ë¡œë„£ê¸°
   //fnRenderTopic(mFnAddTopic(noti_id,'',''))
    //ê·¸ë˜ë„ ëŠë¦¬ë‹¤ ã… ã… 
	$(window).on("load",function(){
		var result=mFnAddTopic(<%=noti_id%>,'','');
		fnRenderTopic(result);
        //ShowAjaxCover(false);
        //========ë‹¬ë ¥ì²´í¬=========
        var today=new Date().toISOString().split('T')[0];
        $('#due_date').attr('min',today);
        
        	});
</script>
<form id="formNoti"  method="POST" action="set_noti_info.html" >
            <input type="hidden" value="<%=noti_id%>" name="noti_id" id="noti_id">
            <input type="hidden" value="<%=dir_code%>" name="dir_code" id="dir_code">
            <input type="hidden" name="exeOption" id="exeOption" readonly value="<%=exeOption%>">
            <table class="table_datagrid">
                <tr>
                    <th>ë§ í¬</th>
                    <td>
                        <input type="text" value="<%=noti_link%>" name="noti_link" id="noti_link" placeholder="ë§í¬ë¥¼ ì ì–´ì£¼ì„¸ìš”" title="ë§í¬ëŠ” ë°˜ë“œì‹œ ì…ë ¥ í•´ì•¼ í•©ë‹ˆë‹¤.">                     
                        <ul class="manual">
	                        <li>ì—°ê²°ì£¼ì†ŒëŠ” httpë¥¼ í¬í•¨í•œ ì „ì²´ì£¼ì†Œë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.</li>
	                        <li>ë©”ì¼ë³¸ë¬¸, ì•±í‘¸ì‹œì•Œë¦¼ í´ë¦­ì‹œ ì—°ê²°ë¨</li>
	                        <li>ì–¸ì–´ì½”ë“œ í¬í•¨ë˜ì§€ ì•Šì€ ì£¼ì†Œ ì‚¬ìš©í•´ì•¼í•¨ ex) https://www.gvg.co.kr/item/123123</li>
	                        <li>ë°œì†¡ì–¸ì–´ì— ë”°ë¼ ì–¸ì–´ì½”ë“œëŠ” ìë™ìœ¼ë¡œ PLUS</li>
                        </ul>
                    </td>    
                </tr>
                <tr>
                    <th>ì œ ëª©</th>
                    <td>
                      <input type="text" value="<%=title%>" name="title" id="title" class="mustinput" placeholder="í•œêµ­ì–´ ì œëª©" title="í•œêµ­ì–´ ì œëª©ì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤."> 
                      <input type="text" id="title_eng" name="title_eng"  value="<%=title_eng%>" placeholder="ì˜ì–´ ì œëª©">
                      <input type="text"  id="title_chn" name="title_chn" value="<%=title_chn%>" placeholder="ì¤‘êµ­ì–´ ì œëª©">
                      <input type="text"  id="title_jpn" name="title_jpn" value="<%=title_jpn%>" placeholder="ì¼ë³¸ì–´ ì œëª©">
                      <ul class="manual">
	                      <li>ê¸´ë¬¸ìì˜ ê²½ìš° í•œêµ­ì–´ ì œëª©ë§Œ ì‚¬ìš©</li>
	                      <li>ê¸´ë¬¸ì ì œëª©ì€ í•œê¸€ê¸°ì¤€ ê³µë°±í¬í•¨ ìµœëŒ€ 20ì ê¹Œì§€ë§Œ ë³´ì—¬ì§.</li>
                      </ul>
                    </td>
                </tr>
                
                <tr>
                    <th>ì†Œì œëª©</th>
                    <td>
	                    <input type="text" name="sub_title" id="sub_title" value="<%=sub_title%>" placeholder="í•œêµ­ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_eng" name="sub_title_eng"  value="<%=sub_title_eng%>" placeholder="ì˜ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_chn" name="sub_title_chn"  value="<%=sub_title_chn%>" placeholder="ì¤‘êµ­ì–´ ì†Œì œëª©">
	                    <input type="text" id="sub_title_jpn" name="sub_title_jpn"  value="<%=sub_title_jpn%>" placeholder="ì¼ë³¸ì–´ ì†Œì œëª©">
	                </td>
                </tr>
                <tr>
                    <th>ì¸ë„¤ì¼</th>
                    <td>
	                    <input id="file_name" dir_code="<%=dir_code%>" type="text" name="file_name" value="<%=file_name%>">
						<a class="btn3 small a_upload" onclick="OpenUploader($(this).prev());">ì—…ë¡œë“œ</a>
						<a <%if file_name <> "" then response.write " href="""&http&"/"&file_name&" "" target=""_blank"" " %> class="btn3 small a_preview" >ë³´ê¸°</a>
						<a class="btn3 small a_delimg">ì‚­ì œ</a>
						<ul class="manual">
							<li>ë©”ì¼ë³¸ë¬¸ ìµœìƒë‹¨ì— ì‚¬ìš©ë¨</li>
	                        <li>ì•±í‘¸ì‹œë°œì†¡ì— ì‚¬ìš©ë¨.</li>
	                        <li>ê°€ë¡œ 700px ì´ìƒ</li>
                        </ul>
	                </td>
                </tr>
                <tr>
                    <th>ë©”ì¼ë³¸ë¬¸</th>
                    <td><textarea name="mail_body" id="mail_body" cols="60" rows="10"><%=mail_body%></textarea>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì˜ì–´</th>
                    <td><textarea name="mail_body_eng" id="mail_body_eng" cols="60" rows="10" ><%=mail_body_eng%></textarea></td>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì¤‘êµ­ì–´</th>
                    <td><textarea name="mail_body_chn" id="mail_body_chn" cols="60" rows="10"><%=mail_body_chn%></textarea></td>
                </tr>
                <tr>
                    <th>ë©”ì¼_ì¼ë³¸ì–´</th>
                    <td><textarea name="mail_body_jpn" id="mail_body_jpn" cols="60" rows="10"><%=mail_body_jpn%></textarea></td>
                    
                </tr>
                <tr>
                    <th>LMS</th>
                    <td>
                        <textarea name="lms_body" id="lms_body" cols="60" rows="10"><%=lms_body%></textarea>
                        <ul class="manual">
	                        <li>" [Webë°œì‹ ], [ê´‘ê³ ], ìˆ˜ì‹ ê±°ë¶€ " ëŠ” ìë™ì²¨ë¶€ì´ë¯€ë¡œ LMSë‚´ìš©ì— ë„£ì§€ ë§ˆì„¸ìš”</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <th>ì˜ˆì•½ë‚ ì§œ</th>
                    <td><input style="width:110px; height:30px;  text-align: center;" type="date" name="due_date" id="due_date" value="<%=due_date%>"></td>
                </tr>
                <tr>
                    <th>ë°œì†¡ì‹œê°„</th>
                    <td id="radioGroup">
                    <%
                    hours=Array(10,11,12,13,14,15,16,17,18)
                    if noti_id <= 0 then
                        due=11
                    end if
                        curHour=Hour(Now())
                        For Each i In hours
                            Response.Write("<input type='radio' name='due' id='due" & i & "' value='" & i & "'")
                            If due = i Then Response.Write(" checked")
                            If i < curHour Then Response.Write(" disabled")
                                Response.Write(" style=""margin-left:20px;"">")
                                Response.Write("<label for ='due" & i & "' style='display:inline-block;'>" & i & "ì‹œ </label>")
                        Next
                        %>                 
                    </td>
                </tr>
                <tr>
                    <th>ë°œì†¡ìˆ˜ë‹¨</th>
                    <td>
                    <div class="flex_div">
	                    <table style="width:540px;">
		                    <thead>
			                    <tr>
		                            <th>ë°œì†¡ìˆ˜ë‹¨</th>
		                            <th>ë°œì†¡ì—¬ë¶€</th>
		                            <th>ë°”ë¡œë°œì†¡</th>
		                            <th>ì˜ˆìƒìˆ˜ì‹ ì</th>
		                            <th style="width:200px;">ë°œì†¡ì¼ì</th>
		                        </tr>
		                    </thead>
		                    <tbody>
		                    	<tr>
			                    	<td style="font-size: 14px; font-weight: bolder;">mail</td>
			                    	<td>
			                    		<input 
			                    			class='flag_checkbox <%if cint(mail_flag)>1 then response.write " hidethis " %>' 
			                    			type='checkbox' 
			                    			name='mail_flag' 
			                    			id='mail_flag' 
			                    			value='1'		
			                    			<%if cint(mail_flag)=1 then response.write " checked" 
                                                
                                            %>
			                    		>
									</td>
									<td>
                                        <a 
                                            id='mail_flag' 
                                            name='mail_flag' 
                                            class='btn2 small sendNow_btn <%if cint(mail_flag) > 1 then response.write " hidethis "%>'  
                                            data-noti-type='email'>ë°”ë¡œë°œì†¡</a>
                                    </td>
									<td id='mail_target'class='target_list' > </td>
									<td><%=sent_date%></td>
		                    	</tr>
                                <tr>
			                    	<td style="font-size: 14px; font-weight: bolder;">lms</td>
			                    	<td>
			                    		<input 
			                    			class='flag_checkbox <%if cint(lms_flag)>1 then response.write " hidethis " %>' 
			                    			type='checkbox' 
			                    			name='lms_flag' 
			                    			id='lms_flag' 
			                    			value='1'
			                    			
			                    			<%if cint(lms_flag)=1 then response.write " checked" %>
			                    		>
									</td>
									<td>
                                        <a 
                                            id='lms_flag' 
                                            name='lms_flag' 
                                            class='btn2 small sendNow_btn <%if cint(lms_flag) > 1 then response.write " hidethis "%>' 
                                            data-noti-type='lms'>ë°”ë¡œë°œì†¡</a>
                                    </td>
									<td id='lms_target'class='target_list' > </td>
									<td><%=sent_date_lms%></td>
		                    	</tr>
                                <tr>
			                    	<td style="font-size: 14px; font-weight: bolder;">fcm</td>
			                    	<td>
			                    		<input 
			                    			class='flag_checkbox <%if cint(fcm_flag)>1 then response.write " hidethis " %>' 
			                    			type='checkbox' 
			                    			name='fcm_flag' 
			                    			id='fcm_flag' 
			                    			value='1'			                    			
			                    			<%if cint(fcm_flag)=1 then response.write " checked" %>
			                    		>
									</td>
									<td>
                                        <a 
                                            id='fcm_flag' 
                                            name='fcm_flag' 
                                            class='btn2 small sendNow_btn <%if cint(fcm_flag) > 1 then response.write " hidethis "%>' 
                                            data-noti-type='fcm'>ë°”ë¡œë°œì†¡</a>
                                    </td>
									<td id='fcm_target'class='target_list' > </td>
									<td style="font-size: 14px; width: 208px;"> <%=sent_date_fcm%></td>
		                    	</tr>
		                    </tbody>
                        </table>
                </tr>
                  <%
' 	                  set myTopic=new Notification
' 	                  myTopic.noti_id=noti_id
                    'topicList  If noti_id>0 Then
'                       set topicRs=myTopic.selectTopicInfo  
                  %>
                <tr>
                  <th>ì „ì†¡ ì£¼ì œ</th>
                  <td>
                    <select name="topic_key" title="ì£¼ì œë¥¼ ì„ íƒí•˜ë©´ í† í”½ì„ ê³ ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.">
	                    <option value="pcs_id" selected>ìƒí’ˆì½”ë“œ</option>
                        <option value="pcs_maker">ë¸Œëœë“œ</option>
                        <option value="idol_id">ì•„ì´ëŒ</option>
                        <option value="unit_id">ìœ   ë‹›</option>
                    </select>
                    <select name="topic_value"></select>
                    <input type="text" name="topic_search" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" title="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥ ë˜ëŠ” ì¹´í…Œê³ ë¦¬ë¥¼ ë³€ê²½ í›„ ê²€ìƒ‰ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”">
                    <a onclick="fnSearchTopic()" class="btn3 big material-icons">search</a>
                    <a onclick="fnAddTopic()" id="a_addTopic" class="btn3 big material-icons">add</a>
					<div class="pd30">
						<ul id="topic_list">
						</ul>
					</div>
                  </td>
                  <%
	                ' topicRs.Close
	                ' set topicRs=nothing                        
                   ' End if
	                 set myTopic=Nothing 
                  %>
                </tr>
                    <%
                        set myFile=new Notification
                        myFile.noti_id=noti_id
                        myFile.file_id=file_id
                        If noti_id>0 Then
                        set fileRs=myFile.selectfileInfo
                    %>
                    <tr>
                        <th>ì²¨ë¶€íŒŒì¼</th>
                        <td>   
                            <input id="noti_filename" dir_code="<%=dir_code%>" type="text" name="noti_filename">
                            <a class="btn3 small a_upload" onclick="OpenUploader($(this).prev());">ì—…ë¡œë“œ</a>
                            <a <%if file_name <> "" then response.write " href="""&http&"/"&file_name&" "" target=""_blank"" " %> class="btn3 small a_preview" >ë³´ê¸°</a>
                            <a class="btn3 small a_delimg">ì‚­ì œ</a>
                            <a style="font-size: 13px; font-weight:bolder; margin-left:3px" onclick="fnAddFile()"class="btn2 small">ì¶”ê°€</a>
                            <a style="font-size: 13px; background-color: red; margin-left: 18px;" onclick="fnSortFile()"class="btn4 small">ìˆœì„œì •ë ¬</a>
                            <ul class="manual">
		                        <li>ê°€ë¡œ 700px ì´ìƒ</li>
		                        <li>ìˆœì„œ ë³€ê²½í›„ ë°˜ë“œì‹œ "ìˆœì„œì •ë ¬" í´ë¦­í•´ì„œ ë°˜ì˜ì‹œì¼œì•¼ í•¨</li>
	                        </ul>
                        <div class="pd30">
                            <ul class="sortable" id="ul_topicfile">
                                        <%
                                        if not(fileRs.eof or fileRs.bof) then	
                                            do until fileRs.EOF
                                                if fileRs("file_name") <> "" then
                                                %>
                                                <li>                                                    
                                                    <div style="margin-left: 3px; background-image:url('<%=fileRs("http")%>/<%=fileRs("file_name")%>'); width: 200px; height: 200px; background-size: cover; background-position: center;" class="thumbnail w100 file_item" file_id="<%=fileRs("file_id")%>" img_src="<%=fileRs("http")%>/<%=fileRs("file_name")%>"></div>
                                                    <a style="margin-top: 12px;" onclick="fnDeleteFile(event)"; class="material-icons file_del" file_id="<%=fileRs("file_id")%>">delete</a>
                                                </li>
                                                <%
                                                end if
                                            fileRs.MoveNext
                                            Loop
                                        end if
                                        %>
                            </ul>
                        </div>
                        
                        <%
                        fileRs.Close
                        set fileRs=nothing
                        set myFile=Nothing 
                        %>
                    </td>
                </tr>
                <tr>
                <th>ë°œì†¡_ê²°ê³¼</th>
                <td>
                    <%
                        Response.Write convertChar(results)
                    %> 
                  </td>
                </tr>
                <%End if
                %>
            </table>     
            <div class="pd30">
				<a class="btn2 biggest" href="noti_list.html">ëª©ë¡ë³´ê¸°</a>
				<a class="btn2 biggest" onclick="fnSubmit('D');">ì‚­ì œí•˜ê¸°</a>
                <% if noti_id > 0 then Response.Write("<a style='margin-left: 25px;' class='btn2 biggest' href='get_noti_preview.html?noti_id=" & noti_id & "' target='_blank'>ë¯¸ë¦¬ë³´ê¸°</a>") %>
                <a style="margin-left: 3px;" id="saveBtn" class="btn3 biggest" onclick="fnSubmit()" >ì €ì¥í•˜ê¸°</a>
            </div>
    </form>